<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tirage 3 cartes gratuit – Oracle Sia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tirage 3 cartes gratuit avec l’Oracle Sia : explorez vos blocages, vos impulsions et votre potentiel.">
 
 <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Oracle Sia : Tirage à 3 cartes",
    "url": "https://oracleheka.github.io/oracle_trium/sia_3cartes.html",
    "description": "Tirage 3 cartes gratuit avec l’Oracle Sia : explorez vos blocages, vos impulsions et votre potentiel.",
    "inLanguage": "fr",
    "author": {
      "@type": "Person",
      "name": "Roland Alberolla"
    }
  }
  </script>
   <style>
    body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #f8f5f2;
  color: #333;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
/* Header */
header {
  background-color: #f5efe6;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between; /* Ajoute de l’espace pour le burger */
  align-items: center;
  position: relative;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
    header nav a {
     display: inline-block;
  padding: 0.75rem 1rem; /* agrandit la zone cliquable */
  margin: 0.5rem 0.75rem; /* espace entre les liens */
  text-decoration: none;
  color: #444;
  font-weight: bold;
  font-size: 1rem; /* assure lisibilité */
    }
    header nav a:hover {
      text-decoration: underline;
}
/* Main */
main {
  flex: 1;
  padding: 3rem 2rem;
  max-width: 900px;
  margin: 0 auto;
}

/* Footer */
footer {
  background-color: #e8e0d8; /* ton plus marqué */
  padding: 1rem;
  text-align: center;
  font-size: 0.9rem;
  color: #222;
  border-top: 1px solid #b8a998; /* bordure plus chaude */
}
   #burgerBtn {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #333;
    }
    #burgerBtn:hover {
      color: #000;
    }
    @media (max-width: 768px) {
      #burgerBtn {
        display: block;
      }
      header nav {
        display: flex;
        flex-direction: column;
        background: #f5efe6;
        position: absolute;
        top: 60px;
        left: 0;
        width: 100%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 1000;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }
      header nav.show {
        max-height: 500px;
      }
    }

/* Boutons */
button {
  padding: 0.7rem 1.5rem;
  background-color: #3b6a9a; /* bleu-grisé plus doux */
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
}
button:hover {
  background-color: #345b85; /* bleu-grisé plus foncé au survol */
}

/* Cadres des cartes */
#resultats > div {
  flex: 1 1 250px;
  max-width: 300px;
  text-align: center;
  border: 1px solid #b8a998; /* bordure beige/brun plus chaude */
  border-radius: 8px;
  background-color: #fdfdfd;
  padding: 1rem;
  margin-bottom: 1rem;
}

/* Ajustement pour PC */
@media (min-width: 768px) {
  #resultats img {
    width: 180px;
  }
}
.btn-retour {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin-top: 2rem;
      background-color: #3b6a9a;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .btn-retour:hover {
      background-color: #345b85;
    }
  /* Améliore la zone tactile des boutons radio */
  fieldset {
  border: none;
  padding: 0;
  margin: 0;
}
fieldset label {
  display: inline-block;
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.2rem;
  font-size: 1rem;
  cursor: pointer;
}
fieldset input[type="radio"] {
  margin-right: 0.5rem;
  transform: scale(1); /* agrandit légèrement la pastille radio */}
    }
  @media (max-width: 768px) {
  fieldset label {
    display: block;
    width: 100%;
  }
  }
  </style>
</head>
<body>

<header>
   <!-- Bouton menu burger -->
<button id="burgerBtn" aria-label="Menu">☰</button>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="apropos.html">À propos</a>
    <a href="methodes.html">Méthodes de Tirages</a>
    <a href="heka.html">Oracle Heka</a>
    <a href="sia.html">Oracle Sia</a>
    <a href="seshat.html">Oracle Seshat</a>
    <a href="decouverte.html">Découverte</a>
  </nav>
</header>

<main>
  <h1>Tirage 3 cartes gratuit – Oracle Sia</h1>
  <p>Explorez vos dynamiques intérieures grâce au tirage à 3 cartes de l’Oracle Sia. Une méthode simple et profonde pour éclairer votre situation présente.</p>
  <h2>Choisissez l’aspect à explorer</h2>
  <p>Personnalité, affectif ou spirituel : chaque aspect révèle une facette unique de la dynamique du tirage.</p>
  <div style="display: flex; align-items: center; gap: 2rem; margin: 1.5rem 0;">
  <fieldset style="border: none; margin: 0;">
  <legend><strong>Choisir l’aspect :</strong></legend>
  <label><input type="radio" name="aspect" value="personnalité" checked> Personnalité</label><br>
  <label><input type="radio" name="aspect" value="affectif"> Affectif</label><br>
  <label><input type="radio" name="aspect" value="spirituel"> Spirituel</label>
</fieldset>
</div>
  <h2>Concentrez-vous sur votre question</h2>
  <div style="margin-top: 2rem;">
  <label for="question"><strong>Posez votre question (facultatif) :</strong></label><br>
  <input type="text" id="question" name="question" placeholder="Écrivez votre question ici..." style="width: 100%; max-width: 600px; padding: 0.6rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 6px;">
</div>
  <div id="resultats" style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;"></div>
   <!-- Bouton pour afficher la synthèse -->
<button id="btnSynthese" style="display:none; margin-top: 1rem;">Voir la synthèse guidante de votre tirage</button>
<div>
  <p><strong>Prêt à découvrir vos liens ?</strong> Lancez le tirage et laissez le murmure de l'Oracle Sia  vous guider.</p> 
  <div style="text-align:center; margin-top:2rem;">
  <button id="melangerBtn" onclick="melangerEtCouper()">Mélanger et couper le jeu</button>
   </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="tirerBtn" onclick="tirerLesCartes()">Tirer les cartes</button>
  </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="ajouterBtn" onclick="ajouterUneCarte()">Ajouter une carte</button>
  </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="réinitialiserBtn" onclick="réinitialiser()">Réinitialiser</button>
  </div>
  <h2>Interprétation du tirage</h2>  
  <p>Ce tirage permet une lecture rapide et efficace d’une situation ou d’une question simple. Il est particulièrement adapté aux demandes à trois volets, comme :</p>
  <ul>
    <li>Passé / Présent / Futur</li>
    <li>Situation / Obstacle / Conseil</li>
    <li>Conflit / Intention / Évolution</li>
  </ul>
  <p>Sia est l’oracle du dedans. Il n’éclaire pas ce qui se voit, mais ce qui murmure en profondeur.
   Il révèle les perceptions subtiles, les mouvements internes, les ressentis que l’on ne sait pas toujours nommer mais que l’on porte en silence.</p>
<p><em>Refaites ce tirage aussi souvent que nécessaire pour affiner votre posture intérieure et avancer plus consciemment.</em></p>
<div class="retour">
    <a href="sia.html" class="btn-retour">← Retour à la page Oracle Sia</a>
  </div>
</main>
<footer style="text-align:center; margin-top: 2rem; padding: 1rem; font-size: 0.9rem;">
  Produit par <strong>OracleHeka</strong> —
 <a href="mentions-legales.html">Mentions légales</a> —
  <a href="mailto:heka.sia.seshat@gmail.com">Contact</a> -
  <a href="faq.html">FAQ</a>
</footer>
 <script>
  let toutesLesCartes = [];
  let cartesDisponibles = [];
  let cartesTirees = [];
  let jeuPrepare = false;

  async function chargerCartes() {
    const reponse = await fetch("https://oracleheka.github.io/oracle_trium/data/sia.json");
    toutesLesCartes = await reponse.json();
    cartesDisponibles = [...toutesLesCartes];
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  async function melangerEtCouper() {
    if (toutesLesCartes.length === 0) {
      await chargerCartes();
    }

    cartesDisponibles = [...toutesLesCartes];
    shuffle(cartesDisponibles);
    jeuPrepare = true;

    document.getElementById("tirerBtn").disabled = false;
    document.getElementById("ajouterBtn").disabled = false;

    alert("Le jeu a été mélangé et coupé !");
  }

  function tirerLesCartes() {
    if (!jeuPrepare) {
      alert("Veuillez d'abord mélanger le jeu.");
      return;
    }

    if (cartesTirees.length > 0) {
      alert("Tirage déjà effectué. Utilisez 'Ajouter une carte'.");
      return;
    }

    document.getElementById("resultats").innerHTML = "";
    cartesTirees = [];

    tirage3Cartes();
  }

  function tirage3Cartes() {
    const tirage = cartesDisponibles.splice(0, 3);
    const aspect = document.querySelector('input[name="aspect"]:checked').value;
    const affichage = document.getElementById("resultats");

    tirage.forEach(carte => {
      const sens = Math.random() < 0.5 ? "endroit" : "inversé";
      cartesTirees.push({ carte: carte, sens: sens });

      const interpretation = carte[sens][aspect]?.texte || "Interprétation manquante.";

      const div = document.createElement("div");
      div.innerHTML = `
        <h3>${carte.id} : (${carte.nom}) : (${sens})</h3>
        <img src="${carte.image}" alt="Carte ${carte.id} – ${carte.nom} de l’Oracle Sia" style="width:150px">
        <p>${interpretation}</p>
      `;
      div.style.padding = "1rem";
      div.style.border = "1px solid #ccc";
      div.style.borderRadius = "8px";
      div.style.backgroundColor = "#fdfdfd";
      div.style.marginBottom = "1rem";

      affichage.appendChild(div);
    });

    document.getElementById("btnSynthese").style.display = "inline-block";
  }

  function ajouterUneCarte(estTirageInitial = false) {
    if (!jeuPrepare) {
      alert("Veuillez d'abord mélanger le jeu.");
      return;
    }

    const maxCartes = 6;
    if (cartesTirees.length >= maxCartes) {
      alert("Nombre maximum de cartes atteint (6).");
      return;
    }

    if (cartesDisponibles.length === 0) {
      alert("Le jeu est vide !");
      return;
    }

    const carte = cartesDisponibles.shift();
    const sens = Math.random() < 0.5 ? "endroit" : "inversé";
    const aspect = document.querySelector('input[name="aspect"]:checked').value;
    cartesTirees.push({ carte: carte, sens: sens });

    const interpretation = carte[sens][aspect]?.texte || "Interprétation manquante.";
    const affichage = document.getElementById("resultats");

    const div = document.createElement("div");
    div.innerHTML = `
      <h3>Carte supplémentaire :${carte.id} : (${carte.nom}) : (${sens})</h3>
      <img src="${carte.image}" alt="Carte ${carte.id} – ${carte.nom} de l’Oracle Seshat" style="width:150px">
      <p>${interpretation}</p>
    `;
    div.style.padding = "1rem";
    div.style.border = "1px solid #ccc";
    div.style.borderRadius = "8px";
    div.style.backgroundColor = "#fdfdfd";
    div.style.marginBottom = "1rem";

    affichage.appendChild(div);

    if (!estTirageInitial && cartesTirees.length === 6) {
      alert("Tirage complet : 3 cartes initiales + 3 couvertures.");
    }
  }
   
  function afficherSynthese3Cartes() {
  const aspect = document.querySelector('input[name="aspect"]:checked').value;
  const question = document.getElementById("question")?.value || "";
  const prenom = document.getElementById("prenom")?.value || "";
  const mode = prenom.toLowerCase() === "ce tirage" ? "lien" : "normal";

  if (cartesTirees.length < 3) {
    alert("Veuillez tirer trois cartes pour générer la synthèse.");
    return;
  }

  // Prépare un résumé clair des 3 cartes
  let resume = "--- Lecture du tirage 3 cartes ---\n\n";
  cartesTirees.forEach(({ carte, sens }) => {
    const interpretation = carte[sens]?.[aspect]?.texte || "(Message manquant)";
    const extrait = interpretation.split(".")[0].trim() + ".";
    resume += `${carte.id} : (${carte.nom}) : (${sens}) → ${extrait}\n`;
  });

  // Ajoute la synthèse guidée finale
  const synthese = genererSyntheseGuidante(cartesTirees, aspect, { question, prenom, mode });
  resume += `\n→ Synthèse guidée :\n\n${synthese}`;

  // Prépare l’affichage visuel
  const contenuDiv = document.getElementById("contenuSynthese");
  contenuDiv.innerHTML = "";

  cartesTirees.forEach(({ carte, sens }) => {
    const imageSrc = carte.image;
    const titre = `${carte.id} : (${carte.nom}) : (${sens})`;
    const texte = carte[sens]?.[aspect]?.texte || "(Message manquant)";

    const carteHtml = `
      <div style="margin-bottom: 1rem;">
        <img src="${imageSrc}" alt="Carte ${carte.id} - ${carte.nom}" style="width: 50px; height: auto;">
        <p>${titre} → ${texte}</p>
      </div>`;
    
    contenuDiv.innerHTML += carteHtml;
  });

  // Ajoute la synthèse finale (bloc texte complet)
  contenuDiv.innerHTML += `<pre style="white-space: pre-wrap; margin-top: 1rem;">${resume}</pre>`;

  // Stocke les variables globales pour l’export PDF
  window.nom1 = prenom;  // Pour compatibilité PDF
  window.aspect = aspect;
  window.question = question;
  window.cartesPrenom1 = cartesTirees;
  window.zoneSilencieuse = []; // Pas de zone silencieuse pour ce tirage
  window.resume = resume;
  window.cartesTireesPDF = cartesTirees.map(({ carte, sens }) => ({
    imageSrc: carte.image,
    nom: carte.nom,
    sens: sens
  }));

  // Affiche la modale
  document.getElementById("syntheseModal").style.display = "flex";
}
  function fermerSynthese() {
    document.getElementById("syntheseModal").style.display = "none";
  }
   function réinitialiser() {
    location.reload();
  }
  window.onload = function () {
  document.getElementById("tirerBtn").disabled = true;
  document.getElementById("ajouterBtn").disabled = true;
  document.getElementById("btnSynthese").onclick = afficherSynthese3Cartes;
};
   
</script>

<div id="syntheseModal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 2rem; max-width: 600px; max-height: 80vh; overflow-y: auto; border-radius: 12px; position: relative;">
    <button onclick="fermerSynthese()" style="position: absolute; top: 10px; right: 10px;">✖</button>
    <h2>Synthèse Guidante</h2>
    <div id="contenuSynthese" style="white-space: pre-wrap; margin-bottom: 1.5rem;"></div>
    <div style="text-align: center;">
      <button onclick="fermerSynthese()" style="background-color: #4a90e2; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; font-size: 1rem; cursor: pointer;">
        Fermer
      </button>
      <button id="exportPDFBtn" style="background-color: #3b6a9a; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; font-size: 1rem; cursor: pointer;">
        Exporter votre tirage
      </button>
    </div>
  </div>
</div>
  <script src="data/synthese.js" defer></script>
   <script>
  const burgerBtn = document.getElementById("burgerBtn");
  const nav = document.querySelector("header nav");

  burgerBtn.addEventListener("click", () => {
    nav.classList.toggle("show");
  });
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>

<script>
  // Fonction pour nettoyer les caractères parasites
  function nettoyerTexte(txt) {
  return txt
    .normalize("NFKC")
    .replace(/[’‘]/g, "'")  // Remplace les guillemets typographiques par des apostrophes simples
    .replace(/[^\x20-\x7EÀ-ÿ\n']/g, '')  // Garde aussi l'apostrophe simple
    .trim();
}
  document.getElementById('exportPDFBtn').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');

    pdf.setFont("Times", "normal");
    let y = 10;
    const pageWidth = pdf.internal.pageSize.getWidth();

    // Logo
    const logoUrl = 'https://oracleheka.github.io/oracle_trium/images/logoheka.png';
    const loadImage = (src) => new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = 'Anonymous';
      img.onload = () => resolve(img);
      img.src = src;
    });
    const logoImg = await loadImage(logoUrl);
    pdf.addImage(logoImg, 'PNG', (pageWidth - 50) / 2, y, 50, 20);
    y += 30;

    // Titre principal (centré)
    const titrePrincipal = `Tirage 3 cartes Sia – ${window.nom1}`;
    const titreWidth = pdf.getTextWidth(titrePrincipal);
    pdf.setFontSize(14);
    pdf.setFont("Times", "bold");
    pdf.text(titrePrincipal, (pageWidth - titreWidth) / 2, y);
    y += 15;

    // ➜ Fonction pour imprimer les cartes tirées
    const cartes = window.cartesPrenom1;
    const aspect = window.aspect;

    pdf.setFontSize(13);
    pdf.setFont("Times", "bold");
    pdf.text("--- Cartes du tirage ---", 10, y);
    y += 8;

    for (const { carte, sens } of cartes) {
      const carteImg = await loadImage(carte.image);

      // Vérifie si la carte va dépasser la page
      if (y + 55 + 8 > 280) {
        pdf.addPage();
        y = 10;
      }

      pdf.addImage(carteImg, 'PNG', 10, y, 40, 50);

      pdf.setFontSize(12);
      pdf.setFont("Times", "bold");
      pdf.text(`${carte.id} : (${carte.nom}) : (${sens})`, 55, y + 6);

      const texte = carte[sens]?.[aspect]?.texte || "(Message manquant)";
      pdf.setFontSize(11);
      pdf.setFont("Times", "normal");
      const lignesCarte = pdf.splitTextToSize(texte, 135);

      let yy = y + 12;
      for (const ligne of lignesCarte) {
        if (yy > 280) { pdf.addPage(); yy = 10; }
        pdf.text(ligne, 55, yy);
        yy += 5;
      }

      yy += 4; // espace après chaque bloc de texte
      const hauteurBloc = Math.max(55, yy - y);
      y += hauteurBloc + 8; // marge plus grande après chaque carte
    }

    // ➜ Ajoute la synthèse finale (une seule fois, proprement)
    const resumeNettoye = window.resume.replace(/[^\x20-\x7EÀ-ÿ\n]/g, '').trim();
    const lignesResume = pdf.splitTextToSize(resumeNettoye, 190);
    pdf.setFontSize(13);
    pdf.setFont("Times", "bold");

    if (y > 280) { pdf.addPage(); y = 10; }
    y += 5;
    pdf.text('→ Synthèse guidée :', 10, y);
    y += 8;

    pdf.setFontSize(11);
    pdf.setFont("Times", "normal");
    for (const ligne of lignesResume) {
      if (y > 280) { pdf.addPage(); y = 10; }
      pdf.text(ligne, 10, y);
      y += 5;
    }

    // ➜ Téléchargement du PDF
    pdf.save(`tirage_3_cartes_Sia_${window.nom1 || 'tirage'}.pdf`);
  });
</script>
</body>
</html>
