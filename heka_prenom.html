<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tirage prénom gratuit – Oracle Heka</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Tirage prénom gratuit avec l’Oracle Heka : explorez votre identité vibratoire et vos dynamiques intérieures à travers la symbolique du prénom.">
 
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Tirage prénom gratuit – Oracle Heka",
  "url": "https://oracleheka.github.io/oracle_trium/heka_prenom.html",
  "description": "Tirage prénom gratuit avec l’Oracle Heka : explorez votre identité vibratoire et vos dynamiques intérieures à travers la symbolique du prénom.",
  "inLanguage": "fr",
  "author": {
    "@type": "Person",
    "name": "Roland Alberolla"
  }
}
</script>  
   <style>
    body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #f8f5f2;
  color: #333;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
/* Header */
header {
  background-color: #f5efe6;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between; /* Ajoute de l’espace pour le burger */
  align-items: center;
  position: relative;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
    header nav a {
     display: inline-block;
  padding: 0.75rem 1rem; /* agrandit la zone cliquable */
  margin: 0.5rem 0.75rem; /* espace entre les liens */
  text-decoration: none;
  color: #444;
  font-weight: bold;
  font-size: 1rem; /* assure lisibilité */
    }
    header nav a:hover {
      text-decoration: underline;
}
/* Main */
main {
  flex: 1;
  padding: 3rem 2rem;
  max-width: 900px;
  margin: 0 auto;
}

/* Footer */
footer {
  background-color: #e8e0d8; /* ton plus marqué */
  padding: 1rem;
  text-align: center;
  font-size: 0.9rem;
  color: #222;
  border-top: 1px solid #b8a998; /* bordure plus chaude */
}
   #burgerBtn {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #333;
    }
    #burgerBtn:hover {
      color: #000;
    }
    @media (max-width: 768px) {
      #burgerBtn {
        display: block;
      }
      header nav {
        display: flex;
        flex-direction: column;
        background: #f5efe6;
        position: absolute;
        top: 60px;
        left: 0;
        width: 100%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 1000;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }
      header nav.show {
        max-height: 500px;
      }
    }

/* Boutons */
button {
  padding: 0.7rem 1.5rem;
  background-color: #3b6a9a; /* bleu-grisé plus doux */
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
}
button:hover {
  background-color: #345b85; /* bleu-grisé plus foncé au survol */
}

/* Cadres des cartes */
#resultats > div {
  flex: 1 1 250px;
  max-width: 300px;
  text-align: center;
  border: 1px solid #b8a998; /* bordure beige/brun plus chaude */
  border-radius: 8px;
  background-color: #fdfdfd;
  padding: 1rem;
  margin-bottom: 1rem;
}

/* Ajustement pour PC */
@media (min-width: 768px) {
  #resultats img {
    width: 180px;
  }
}
.btn-retour {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin-top: 2rem;
      background-color: #3b6a9a;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .btn-retour:hover {
      background-color: #345b85;
    }
  /* Améliore la zone tactile des boutons radio */
  fieldset {
  border: none;
  padding: 0;
  margin: 0;
}
fieldset label {
  display: inline-block;
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.2rem;
  font-size: 1rem;
  cursor: pointer;
}
fieldset input[type="radio"] {
  margin-right: 0.5rem;
  transform: scale(1); /* agrandit légèrement la pastille radio */}
    }
  @media (max-width: 768px) {
  fieldset label {
    display: block;
    width: 100%;
  }
  }
  </style>
</head>
<body>

<header>
   <!-- Bouton menu burger -->
<button id="burgerBtn" aria-label="Menu">☰</button>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="apropos.html">À propos</a>
    <a href="methodes.html">Méthodes de Tirages</a>
    <a href="heka.html">Oracle Heka</a>
    <a href="sia.html">Oracle Sia</a>
    <a href="seshat.html">Oracle Seshat</a>
    <a href="decouverte.html">Découverte</a>
  </nav>
</header>

<main>
  <h1>Tirage prénom gratuit – Oracle Heka</h1>
<p>Plongez dans la symbolique de votre prénom avec l’Oracle Heka. Ce tirage révèle les énergies vibratoires et les tensions inconscientes qui vous traversent, offrant un miroir intime de votre identité projetée.</p>
  <h2>Choisissez l’aspect à explorer</h2>
  <div style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0;">
  <fieldset style="border: none; margin: 0;">
  <legend><strong>Choisir l’aspect :</strong></legend>
  <label><input type="radio" name="aspect" value="personnalité" checked> Personnalité</label><br>
  <label><input type="radio" name="aspect" value="matériel"> Matériel</label><br>
  <label><input type="radio" name="aspect" value="professionnel"> Professionnel</label><br>
  <label><input type="radio" name="aspect" value="affectif"> Affectif</label><br>
  <label><input type="radio" name="aspect" value="spirituel"> Spirituel</label>
</fieldset>
  </div>
  <h2>Concentrez-vous sur votre question</h2>
  <div style="margin-top: 0.5rem;">
  <label for="question"><strong>Posez votre question (facultatif) :</strong></label><br>
  <input type="text" id="question" name="question" placeholder="Écrivez votre question ici..." style="width: 100%; max-width: 600px; padding: 0.6rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 6px;">
  </div> 
  <div style="margin-top: 0.5rem;">
    <label for="prénom"><strong>Prénom :</strong></label><br>
  <input type="text" id="champPrenom" name="prenom" placeholder="Entrer votre prénom" style="width: 100%; max-width: 600px; padding: 0.6rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 6px;">  
  <div id="resultats" style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
  </div>
  <div id="resultats" style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
  <!-- Bouton pour afficher la synthèse -->
<button id="btnSynthese" style="display:none; margin-top: 0.5rem;">Consultez votre synthèse guidante</button>
</div>
  <p><strong>Prêt à découvrir vos liens ?</strong> Lancez le tirage et laissez la voix de l'Oracle Heka  vous guider.</p>
  <div style="text-align:center; margin-top:2rem;">
  <button id="melangerBtn" onclick="melangerEtCouper()">Mélanger et couper le jeu</button>
   </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="tirerBtn" onclick="tirerLesCartes()">Tirer les cartes</button>
  </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="ajouterBtn" onclick="ajouterUneCarte()">Ajouter une carte</button>
  </div>
  <div style="text-align:center; margin-top:2rem;">
  <button id="réinitialiserBtn" onclick="réinitialiser()">Réinitialiser</button>
  </div>
  <h2>Interprétation du tirage</h2>
<p>Chaque lettre de votre prénom reçoit une carte. Ce tirage offre une lecture symbolique et profonde de votre identité projetée, mettant en lumière :</p>
<ul>
  <li>Vos forces et vos zones de tension</li>
  <li>Les obstacles inconscients qui freinent votre épanouissement</li>
  <li>Les leviers pour harmoniser votre expression personnelle</li>
</ul>
<p>L’Oracle Heka agit ici comme un miroir subtil de vos énergies intérieures, révélant ce qui s’exprime ou se tait, et éclairant les pistes pour rééquilibrer votre posture intérieure.</p>
<p><em>Revenez à tout moment pour refaire ce tirage et affiner votre compréhension de votre prénom.</em></p>
<div class="retour">
    <a href="heka.html" class="btn-retour">← Retour à la page Oracle Heka</a>
  </div>
</main>
<footer style="text-align:center; margin-top: 2rem; padding: 1rem; font-size: 0.9rem;">
  Produit par <strong>OracleHeka</strong> —
  <a href="mentions-legales.html">Mentions légales</a> —
  <a href="mailto:heka.sia.seshat@gmail.com">Contact</a> -
  <a href="faq.html">FAQ</a>
</footer> 
 <script>
  let toutesLesCartes = [];
  let cartesDisponibles = [];
  let cartesTirees = [];
  let jeuPrepare = false;

  async function chargerCartes() {
    const reponse = await fetch("https://oracleheka.github.io/oracle_trium/data/heka.json");
    toutesLesCartes = await reponse.json();
    cartesDisponibles = [...toutesLesCartes];
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  async function melangerEtCouper() {
    if (toutesLesCartes.length === 0) {
      await chargerCartes();
    }

    cartesDisponibles = [...toutesLesCartes];
    shuffle(cartesDisponibles);
    jeuPrepare = true;

    document.getElementById("tirerBtn").disabled = false;
    document.getElementById("ajouterBtn").disabled = false;

    alert("Le jeu a été mélangé et coupé !");
  }
function tirerParPrenom() {
  console.log("✅ Début tirerParPrenom");

  if (!jeuPrepare) {
    console.warn("❌ Le jeu n’a pas été préparé.");
    alert("Veuillez d'abord mélanger le jeu.");
    return;
  }

  const champ = document.getElementById("champPrenom");
  if (!champ) {
    console.error("❌ champPrenom introuvable !");
    return;
  }

  let nom = champ.value.trim().toUpperCase();
  console.log("→ Nom saisi :", nom);
  if (!nom) {
    alert("Veuillez entrer un prénom.");
    return;
  }

  if (cartesDisponibles.length < nom.length) {
    console.warn("❌ Pas assez de cartes :", cartesDisponibles.length);
    alert("Pas assez de cartes disponibles pour ce prénom.");
    return;
  }

  const aspectRadio = document.querySelector('input[name="aspect"]:checked');
  if (!aspectRadio) {
    console.error("❌ Aucun aspect sélectionné !");
    alert("Veuillez sélectionner un aspect.");
    return;
  }

  const aspect = aspectRadio.value;
  console.log("→ Aspect sélectionné :", aspect);

  const affichage = document.getElementById("resultats");
  if (!affichage) {
    console.error("❌ Zone d'affichage introuvable !");
    return;
  }

  affichage.innerHTML = "";
  cartesTirees = [];

  for (let lettre of nom) {
    const carte = cartesDisponibles.shift();
    if (!carte) {
      console.error("❌ Carte manquante à l'étape :", lettre);
      continue;
    }

    const sens = Math.random() < 0.5 ? "endroit" : "inversé";
    cartesTirees.push({ carte: carte, sens: sens }); // ← AJOUT ICI ✅
    const interpretation = carte[sens]?.[aspect]?.texte;

    if (!interpretation) {
      console.warn(`⚠️ Aucune interprétation pour la carte ${carte.nom} [${sens}] - [${aspect}]`);
    }

    const texte = interpretation || "(Message manquant)";
    console.log(`✅ Carte pour ${lettre} :`, carte.nom, "|", sens, "|", texte);

    const div = document.createElement("div");
    div.innerHTML = `
      <strong>Lettre : ${lettre}</strong><br>
      <strong>${carte.id} : (${carte.nom}) : (${sens})</strong><br>
      <img src="${carte.image}" alt="Carte ${carte.id} – ${carte.nom} de l’Oracle Heka" style="width:100px"><br>
      <p style="margin-top:0.5rem;">${interpretation}</p>
    `;
    styleCarte(div);
    affichage.appendChild(div);
  }
  document.getElementById("btnSynthese").style.display = "inline-block";
  
  console.log("✅ Fin du tirage prénom");
  }   
function ajouterUneCarte() {
  if (!jeuPrepare) {
    alert("Veuillez d'abord mélanger le jeu.");
    return;
  }

  const champ = document.getElementById("champPrenom");
  let nom = champ.value.trim().toUpperCase();
  if (!nom) {
    alert("Veuillez entrer un prénom.");
    return;
  }

  const maxCartes = nom.length + 3;

  if (cartesTirees.length >= maxCartes) {
    alert(`Nombre maximum de cartes atteint (${maxCartes}).`);
    return;
  }

  if (cartesDisponibles.length === 0) {
    alert("Le jeu est vide !");
    return;
  }

  const carte = cartesDisponibles.shift();
  const sens = Math.random() < 0.5 ? "endroit" : "inversé";
  const aspect = document.querySelector('input[name="aspect"]:checked').value;
  const texte = carte[sens][aspect]?.texte || "(Message manquant)";

  cartesTirees.push({ carte: carte, sens: sens });

  const affichageZone = document.getElementById("resultats");
  const div = document.createElement("div");
  div.innerHTML = `
    <strong>Carte supplémentaire</strong><br>
    <strong>${carte.id} : (${carte.nom}) : (${sens})</strong><br>
    <img src="${carte.image}" alt="Carte ${carte.id} – ${carte.nom} de l’Oracle Heka" style="width:100px"><br>
    <p style="margin-top:0.5rem;">${interpretation}</p>
  `;
  styleCarte(div);
  affichageZone.appendChild(div);
}

   function afficherSynthesePrenom() {
  const aspect = document.querySelector('input[name="aspect"]:checked').value;
  const prenomInput = document.getElementById("champPrenom")?.value || "";
  const prenom = prenomInput.charAt(0).toUpperCase() + prenomInput.slice(1).toLowerCase();

  if (cartesTirees.length === 0) {
    alert("Veuillez d'abord tirer les cartes.");
    return;
  }

  // Résumé lisible
  let resume = `--- Synthèse du prénom ---\n\n`;
  cartesTirees.forEach(({ carte, sens }) => {
    const interpretation = carte[sens][aspect]?.texte || "(Message manquant)";
    resume += `${carte.id} : (${carte.nom}) : (${sens}) → ${interpretation}\n`;
  });

  // Synthèse globale
  const question = document.getElementById("question")?.value || "";
  const mode = "normal";
  const synthese = genererSyntheseGuidante(cartesTirees, aspect, { question, prenom, mode });

  resume += `\n→ Synthèse guidée :\n\n${synthese}`;
// Prépare l’affichage visuel
  const contenuDiv = document.getElementById("contenuSynthese");
  contenuDiv.innerHTML = "";

  cartesTirees.forEach(({ carte, sens }) => {
    const imageSrc = carte.image;
    const titre = `${carte.id} : (${carte.nom}) : (${sens})`;
    const texte = carte[sens]?.[aspect]?.texte || "(Message manquant)";

    const carteHtml = `
      <div style="margin-bottom: 1rem;">
        <img src="${imageSrc}" alt="Carte ${carte.id} - ${carte.nom}" style="width: 50px; height: auto;">
        <p>${titre} → ${texte}</p>
      </div>`;

    contenuDiv.innerHTML += carteHtml;
  });

  // Ajoute la synthèse finale (bloc texte propre)
  contenuDiv.innerHTML += `<pre style="white-space: pre-wrap; margin-top: 1rem;">${resume}</pre>`;

  // Stocke les variables globales pour l’export PDF
  window.nom1 = prenom;  // pour la compatibilité PDF
  window.aspect = aspect;
  window.question = question;
  window.cartesPrenom1 = cartesTirees;
  window.zoneSilencieuse = []; // pas de zone silencieuse ici
  window.resume = resume;      // stocke pour le PDF
  window.cartesTireesPDF = cartesTirees.map(({ carte, sens }) => ({
    imageSrc: carte.image,
    nom: carte.nom,
    sens: sens
  }));

  // Affiche la modale
  document.getElementById("syntheseModal").style.display = "flex";
}

   function fermerSynthese() {
  document.getElementById("syntheseModal").style.display = "none";
}
   
  function réinitialiser() {
  location.reload(); // Recharge la page pour repartir de zéro
}
function tirerLesCartes() {
  tirerParPrenom();
}
   function styleCarte(el) {
  el.style.padding = "1rem";
  el.style.border = "1px solid #ccc";
  el.style.borderRadius = "8px";
  el.style.backgroundColor = "#fdfdfd";
  el.style.minWidth = "100px";
  el.style.textAlign = "center";
  el.style.marginTop = "0.5rem";
}
// Rendre le bouton fonctionnel au chargement
window.onload = function () {
  document.getElementById("tirerBtn").disabled = true;
  document.getElementById("ajouterBtn").disabled = true;
  document.getElementById("btnSynthese").onclick = afficherSynthesePrenom;
};
</script>
<div id="syntheseModal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 2rem; max-width: 600px; max-height: 80vh; overflow-y: auto; border-radius: 12px; position: relative;">
    <button onclick="fermerSynthese()" style="position: absolute; top: 10px; right: 10px;">✖</button>
    <h2>Synthèse Guidante de l'oracle d'Heka</h2>
    <div id="contenuSynthese" style="white-space: pre-wrap; margin-bottom: 1.5rem;"></div>
    <div style="text-align: center;">
      <button onclick="fermerSynthese()" style="background-color: #4a90e2; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; font-size: 1rem; cursor: pointer;">
        Fermer
      </button>
      <button id="exportPDFBtn" style="background-color: #3b6a9a; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; font-size: 1rem; cursor: pointer;">
        Exporter votre tirage
      </button>
    </div>
  </div>
</div>
  <script src="data/synthese.js" defer></script>
  <script>
  const burgerBtn = document.getElementById("burgerBtn");
  const nav = document.querySelector("header nav");

  burgerBtn.addEventListener("click", () => {
    nav.classList.toggle("show");
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>

<script>
  // Fonction pour nettoyer les caractères parasites
  function nettoyerTexte(txt) {
  return txt
    .normalize("NFKC")
    .replace(/[’‘]/g, "'")  // Remplace les guillemets typographiques par des apostrophes simples
    .replace(/[^\x20-\x7EÀ-ÿ\n']/g, '')  // Garde aussi l'apostrophe simple
    .trim();
}
  document.getElementById('exportPDFBtn').addEventListener('click', async () => {
    const prenom = window.nom1;
    const aspect = window.aspect;
    const question = window.question;
    const cartesPrenom = window.cartesPrenom1;

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    pdf.setFont("Times", "normal");
    let y = 10;
    const pageWidth = pdf.internal.pageSize.getWidth();

    // Logo
    const logoUrl = 'https://oracleheka.github.io/oracle_trium/images/logoheka.png';
    const loadImage = (src) => new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = 'Anonymous';
      img.onload = () => resolve(img);
      img.src = src;
    });
    const logoImg = await loadImage(logoUrl);
    pdf.addImage(logoImg, 'PNG', (pageWidth - 50) / 2, y, 50, 20);
    y += 30;

    // Titre principal (centré)
    const titrePrincipal = `Tirage Heka pour ${prenom}`;
    const titreWidth = pdf.getTextWidth(titrePrincipal);
    pdf.setFontSize(14);
    pdf.setFont("Times", "bold");
    pdf.text(titrePrincipal, (pageWidth - titreWidth) / 2, y);
    y += 15;

    // ➜ Fonction pour imprimer les cartes du prénom
    async function imprimerCartes(cartes) {
      pdf.setFontSize(13);
      pdf.setFont("Times", "bold");
      pdf.text(`--- Cartes pour ${prenom} ---`, 10, y);
      y += 8;

      for (const { carte, sens } of cartes) {
        const carteImg = await loadImage(carte.image);
        pdf.addImage(carteImg, 'PNG', 10, y, 40, 50);

        pdf.setFontSize(12);
        pdf.setFont("Times", "bold");
        pdf.text(`${carte.id} : (${carte.nom}) : (${sens})`, 55, y + 6);

        const texte = carte[sens]?.[aspect]?.texte || "(Message manquant)";
        pdf.setFontSize(11);
        pdf.setFont("Times", "normal");
        const lignesCarte = pdf.splitTextToSize(texte, 135);

        let yy = y + 12;
        for (const ligne of lignesCarte) {
          if (yy > 280) { pdf.addPage(); yy = 10; }
          pdf.text(ligne, 55, yy);
          yy += 5;
        }

        const hauteurBloc = Math.max(55, yy - y);
        y += hauteurBloc + 5;
        if (y > 260) { pdf.addPage(); y = 10; }
      }
      y += 4;
    }

    // ➜ Imprimer les cartes du prénom
    await imprimerCartes(cartesPrenom);

    // ➜ Ajoute la synthèse finale (une seule fois, proprement)
    const resumeNettoye = nettoyerTexte(window.resume);
    const lignesResume = pdf.splitTextToSize(resumeNettoye, 190);
    pdf.setFontSize(11);
    pdf.setFont("Times", "normal");

    if (y > 280) { pdf.addPage(); y = 10; }
    y += 10; // espace avant la synthèse finale

    for (const ligne of lignesResume) {
      if (y > 280) { pdf.addPage(); y = 10; }
      pdf.text(ligne, 10, y);
      y += 5;
    }

    // ➜ Téléchargement du PDF
    pdf.save(`tirage_prenom_Heka${prenom}.pdf`);
  });
</script>
</body>
</html>
